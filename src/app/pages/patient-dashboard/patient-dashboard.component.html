<app-dashboard-layout [userProfile]="userProfile" pageTitle="Minha Dieta">
  <!-- Welcome Section -->
  <div class="welcome-section">
    <h1 class="welcome-title">Ol√°, {{ userProfile.name }}! üçΩÔ∏è</h1>
    <p class="welcome-subtitle">Planeje suas refei√ß√µes para a semana</p>
  </div>

  <!-- Today's Meals Highlight -->
  <div class="today-section">
    <h2 class="section-title">Refei√ß√µes de Hoje - {{ getTodayDate() }}</h2>
    <div class="today-meals" *ngIf="todayMeals$ | async as todayMeals">
      <div class="meal-card today" *ngFor="let meal of todayMeals">
        <div class="meal-header">
          <span class="meal-icon">{{ meal.icon }}</span>
          <h3 class="meal-name">{{ meal.mealType }}</h3>
        </div>
        <div class="meal-content">
          <div class="selected-option" *ngIf="meal.assignedOption; else noSelection">
            <h4>{{ meal.assignedOption.name }}</h4>
            <ul class="ingredients-list">
              <li *ngFor="let item of meal.assignedOption.items">{{ item.quantity }} - {{ item.description }}</li>
            </ul>
            <button class="btn-select change-btn" (click)="openMealSelector(this.currentWeekStart, meal.mealType)">
              Alterar
            </button>
          </div>
          <ng-template #noSelection>
            <div class="no-selection">
              <p>Nenhuma op√ß√£o selecionada</p>
              <button class="btn-select" (click)="openMealSelector(this.currentWeekStart, meal.mealType)">
                Escolher Refei√ß√£o
              </button>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Planner -->
  <div class="weekly-planner-section">
    <h2 class="section-title">Planejador Semanal</h2>
    <div class="week-navigation">
      <button class="week-nav-btn" (click)="previousWeek()">‚Äπ</button>
      <span class="week-display">{{ getCurrentWeekDisplay() }}</span>
      <button class="week-nav-btn" (click)="nextWeek()">‚Ä∫</button>
    </div>

    <div class="days-grid" *ngIf="weekData$ | async as weekDays">
      <div class="day-column" *ngFor="let day of weekDays">
        <div class="day-header">
          <h3 class="day-name">{{ day.dayName }}</h3>
          <span class="day-date">{{ day.dayNumber }}</span>
        </div>
        <div class="day-meals">
          <div class="meal-slot" *ngFor="let slot of day.slots">
            <div class="meal-slot-header">
              <span class="meal-icon">{{ slot.icon }}</span>
              <span class="meal-name">{{ slot.mealType }}</span>
            </div>
            <div class="meal-selection" [class.empty]="!slot.assignedOption" (click)="openMealSelector(day.date, slot.mealType)">
              <div *ngIf="slot.assignedOption; else emptyMeal" class="selected-meal">
                <h4>{{ slot.assignedOption.name }}</h4>
              </div>
              <ng-template #emptyMeal>
                <div class="empty-meal">
                  <span class="plus-icon">+</span>
                  <p>Escolher</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-meal-selection-modal #mealModal (mealSelected)="onMealSelected($event)"></app-meal-selection-modal>
</app-dashboard-layout>
