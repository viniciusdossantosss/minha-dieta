<app-dashboard-layout 
  pageTitle="Minha Dieta"
  [userProfile]="userProfile">
  
  <!-- Welcome Section -->
  <div class="welcome-section">
    <h1 class="welcome-title">Ol√°, {{ userProfile.name }}! üçΩÔ∏è</h1>
    <p class="welcome-subtitle">Planeje suas refei√ß√µes para a semana</p>
  </div>

  <!-- Today's Meals Highlight -->
  <div class="today-section">
    <h2 class="section-title">Refei√ß√µes de Hoje - {{ getTodayDate() }}</h2>
    <div class="today-meals">
      <div class="meal-card today" *ngFor="let meal of todayMeals">
        <div class="meal-header">
          <span class="meal-icon">{{ meal.icon }}</span>
          <h3 class="meal-name">{{ meal.name }}</h3>
          <span class="meal-status" [class]="meal.status">
            {{ getStatusText(meal.status) }}
          </span>
        </div>
        <div class="meal-content">
          <div class="selected-option" *ngIf="meal.selectedOption">
            <h4>{{ meal.selectedOption.name }}</h4>
            <ul class="ingredients-list">
              <li *ngFor="let ingredient of meal.selectedOption.ingredients">{{ ingredient }}</li>
            </ul>
            <button class="btn-select change-btn" (click)="selectMealOption(meal.id, 'today')">
              Alterar
            </button>
          </div>
          <div class="no-selection" *ngIf="!meal.selectedOption">
            <p>Nenhuma op√ß√£o selecionada</p>
            <button class="btn-select" (click)="selectMealOption(meal.id, 'today')">
              Escolher Refei√ß√£o
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Progress -->
  <div class="progress-section">
    <h2 class="section-title">Progresso da Semana</h2>
    <div class="progress-stats">
      <div class="progress-card">
        <div class="progress-icon">‚úÖ</div>
        <div class="progress-content">
          <h3>{{ weeklyProgress.completed }}</h3>
          <p>Refei√ß√µes Escolhidas</p>
        </div>
      </div>
      <div class="progress-card">
        <div class="progress-icon">‚è≥</div>
        <div class="progress-content">
          <h3>{{ weeklyProgress.pending }}</h3>
          <p>Pendentes</p>
        </div>
      </div>
      <div class="progress-card">
        <div class="progress-icon">üìä</div>
        <div class="progress-content">
          <h3>{{ weeklyProgress.percentage }}%</h3>
          <p>Ades√£o</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Planner -->
  <div class="weekly-planner-section">
    <h2 class="section-title">Planejador Semanal</h2>
    
    <!-- Week Navigation -->
    <div class="week-navigation">
      <button class="week-nav-btn" (click)="previousWeek()">‚Äπ</button>
      <span class="week-display">{{ getCurrentWeekDisplay() }}</span>
      <button class="week-nav-btn" (click)="nextWeek()">‚Ä∫</button>
    </div>

    <!-- Days Grid -->
    <div class="days-grid">
      <div class="day-column" *ngFor="let day of weekDays">
        <div class="day-header">
          <h3 class="day-name">{{ day.name }}</h3>
          <span class="day-date">{{ day.date }}</span>
        </div>
        
        <div class="day-meals">
          <div class="meal-slot" *ngFor="let meal of day.meals">
            <div class="meal-slot-header">
              <span class="meal-icon">{{ meal.icon }}</span>
              <span class="meal-name">{{ meal.name }}</span>
            </div>
            
            <div class="meal-selection" *ngIf="meal.selectedOption" 
                 (click)="selectMealOption(meal.id, day.id)">
              <div class="selected-meal">
                <h4>{{ meal.selectedOption.name }}</h4>
                <p class="meal-description">{{ meal.selectedOption.description }}</p>
              </div>
            </div>
            
            <div class="meal-selection empty" *ngIf="!meal.selectedOption"
                 (click)="selectMealOption(meal.id, day.id)">
              <div class="empty-meal">
                <span class="plus-icon">+</span>
                <p>Escolher</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions-section">
    <h2 class="section-title">A√ß√µes R√°pidas</h2>
    <div class="actions-grid">
      <button class="action-card" (click)="viewNutritionistContact()">
        <div class="action-icon">üë©‚Äç‚öïÔ∏è</div>
        <div class="action-content">
          <h3>Contatar Nutricionista</h3>
          <p>Tirar d√∫vidas sobre o card√°pio</p>
        </div>
      </button>

      <button class="action-card" (click)="viewMealHistory()">
        <div class="action-icon">üìã</div>
        <div class="action-content">
          <h3>Hist√≥rico</h3>
          <p>Ver refei√ß√µes anteriores</p>
        </div>
      </button>

      <button class="action-card" (click)="viewProgress()">
        <div class="action-icon">üìà</div>
        <div class="action-content">
          <h3>Meu Progresso</h3>
          <p>Acompanhar evolu√ß√£o</p>
        </div>
      </button>
    </div>
  </div>

  <!-- AQUI: Componente da Modal de Sele√ß√£o de Refei√ß√µes -->
  <app-meal-selection-modal 
  [isOpen]="isMealModalOpen" 
  [mealData]="currentMealData" 
  [availableOptions]="availableMealOptionsForModal"
    (mealSelected)="onMealSelected($event)"
    (close)="closeMealModal()">
  </app-meal-selection-modal>

</app-dashboard-layout>