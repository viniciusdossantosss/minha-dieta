<app-dashboard-layout [userProfile]="userProfile" [pageTitle]="pageTitle">
  <div class="form-card">
    <form [formGroup]="mealForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <!-- Nome da Refeição -->
        <div class="form-group">
          <label for="name">Nome da Opção *</label>
          <input id="name" type="text" formControlName="name" class="form-control" [class.is-invalid]="isFieldInvalid('name')" placeholder="Ex: Omelete com queijo e tomate">
          <div class="error-message" *ngIf="isFieldInvalid('name')">
            Nome da opção é obrigatório.
          </div>
        </div>

        <!-- Tipo de Refeição -->
        <div class="form-group">
          <label for="type">Tipo de Refeição *</label>
          <select id="type" formControlName="type" class="form-control" [class.is-invalid]="isFieldInvalid('type')">
            <option [ngValue]="null" disabled>Selecione o tipo</option>
            <option *ngFor="let type of mealTypes" [value]="type">{{ type }}</option>
          </select>
          <div class="error-message" *ngIf="isFieldInvalid('type')">
            Tipo de refeição é obrigatório.
          </div>
        </div>

        <!-- Itens da Refeição -->
        <div class="full-width">
          <div formArrayName="items">
            <div *ngFor="let item of items.controls; let i=index" [formGroupName]="i" class="meal-entry-group">
              <div class="form-grid">
                <div class="form-group">
                  <label [for]="'quantity-' + i">Quantidade *</label>
                  <input [id]="'quantity-' + i" type="text" formControlName="quantity" class="form-control" placeholder="Ex: 2 unidades">
                </div>
                <div class="form-group">
                  <label [for]="'description-' + i">Descrição *</label>
                  <input [id]="'description-' + i" type="text" formControlName="description" class="form-control" placeholder="Ex: Ovos">
                </div>
              </div>
              <div class="meal-entry-actions">
                <button type="button" class="btn-remove" (click)="removeItem(i)">Remover Item</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-secondary add-entry-button" (click)="addItem()">
        Adicionar Item
      </button>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="goBack()">Voltar</button>
        <button type="submit" class="btn btn-primary" [disabled]="mealForm.invalid">
          {{ isEditMode ? 'Atualizar Refeição' : 'Salvar Refeição' }}
        </button>
      </div>
    </form>
  </div>
</app-dashboard-layout>